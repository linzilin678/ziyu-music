<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¢“æ¸éŸ³ä¹æ’­æ”¾å™¨</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .player-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
        }
        .album-art {
            width: 200px;
            height: 200px;
            background: linear-gradient(45deg, #ff9a9e, #fad0c4);
            border-radius: 50%;
            margin: 0 auto 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            color: white;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .song-info {
            margin-bottom: 30px;
        }
        .song-title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .song-artist {
            color: #666;
            font-size: 18px;
        }
        audio {
            width: 100%;
            margin: 20px 0;
            outline: none;
        }
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 50px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        .btn:hover {
            background: #764ba2;
            transform: translateY(-2px);
        }
        .loading {
            color: #666;
            font-style: italic;
        }
        .error {
            color: #ff4757;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="player-container">
        <div class="album-art">ğŸµ</div>
        <div class="song-info">
            <div class="song-title" id="songTitle">æ¢“æ¸ - è¤ç«æ˜Ÿçƒ</div>
            <div class="song-artist" id="songArtist">è§¦ç¢°æ’­æ”¾</div>
        </div>
        
        <div class="loading" id="loadingText">æ­£åœ¨åŠ è½½éŸ³ä¹...</div>
        
        <audio id="audioPlayer" controls>
            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾
        </audio>
        
        <div class="controls">
            <button class="btn" id="downloadBtn">
                <span>â¬‡ï¸</span> ä¸‹è½½
            </button>
            <button class="btn" onclick="shareMusic()">
                <span>ğŸ“¤</span> åˆ†äº«
            </button>
        </div>
        
        <div class="error" id="errorMsg"></div>
        
        <div style="margin-top: 30px; color: #888; font-size: 14px;">
            NFCéŸ³ä¹æ’­æ”¾å™¨ | æ¢“æ¸éŸ³ä¹
        </div>
    </div>

    <script>
        // è·å–URLå‚æ•°
        function getUrlParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }
        
        // æå–æ–‡ä»¶å
        function getFileName(url) {
            try {
                const decodedUrl = decodeURIComponent(url);
                const pathParts = decodedUrl.split('/');
                const fileName = pathParts[pathParts.length - 1];
                return fileName.replace('.mp3', '').replace(/[+\-]/g, ' ');
            } catch (e) {
                return 'æœªçŸ¥æ­Œæ›²';
            }
        }
        
        // åˆå§‹åŒ–æ’­æ”¾å™¨
        async function initPlayer() {
            try {
                const musicUrl = getUrlParameter('url');
                
                if (!musicUrl) {
                    showError('æœªæ‰¾åˆ°éŸ³ä¹é“¾æ¥');
                    return;
                }
                
                // è®¾ç½®æ­Œæ›²ä¿¡æ¯
                const fileName = getFileName(musicUrl);
                document.getElementById('songTitle').textContent = fileName;
                
                // è®¾ç½®éŸ³é¢‘æ’­æ”¾å™¨
                const audioPlayer = document.getElementById('audioPlayer');
                audioPlayer.src = musicUrl;
                
                // è®¾ç½®ä¸‹è½½æŒ‰é’®
                const downloadBtn = document.getElementById('downloadBtn');
                downloadBtn.onclick = () => {
                    const a = document.createElement('a');
                    a.href = musicUrl;
                    a.download = fileName + '.mp3';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                };
                
                // å°è¯•è‡ªåŠ¨æ’­æ”¾
                setTimeout(() => {
                    audioPlayer.play().catch(e => {
                        console.log('è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢ï¼Œéœ€è¦ç”¨æˆ·äº¤äº’');
                    });
                }, 500);
                
                // éšè—åŠ è½½æç¤º
                document.getElementById('loadingText').style.display = 'none';
                
            } catch (error) {
                showError('æ’­æ”¾å™¨åˆå§‹åŒ–å¤±è´¥: ' + error.message);
            }
        }
        
        // åˆ†äº«åŠŸèƒ½
        async function shareMusic() {
            const shareData = {
                title: document.getElementById('songTitle').textContent,
                text: 'åˆ†äº«ä¸€é¦–å¥½å¬çš„éŸ³ä¹',
                url: window.location.href
            };
            
            if (navigator.share) {
                try {
                    await navigator.share(shareData);
                } catch (err) {
                    console.log('åˆ†äº«å–æ¶ˆ:', err);
                }
            } else {
                // å¤åˆ¶é“¾æ¥åˆ°å‰ªè´´æ¿
                navigator.clipboard.writeText(window.location.href)
                    .then(() => alert('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼'))
                    .catch(() => prompt('è¯·æ‰‹åŠ¨å¤åˆ¶é“¾æ¥:', window.location.href));
            }
        }
        
        // æ˜¾ç¤ºé”™è¯¯
        function showError(message) {
            document.getElementById('errorMsg').textContent = message;
        }
        
        // é¡µé¢åŠ è½½å®Œæˆ
        document.addEventListener('DOMContentLoaded', initPlayer);
    </script>
</body>
</html>